// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums
enum UserRole {
  ADMIN
  PRINCIPAL
  TEACHER
  STUDENT
  PARENT
  ACCOUNTANT
  LIBRARIAN
  TRANSPORT_STAFF
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum BloodGroup {
  A_POSITIVE
  A_NEGATIVE
  B_POSITIVE
  B_NEGATIVE
  AB_POSITIVE
  AB_NEGATIVE
  O_POSITIVE
  O_NEGATIVE
}

enum FeeStatus {
  PAID
  PENDING
  PARTIAL
  OVERDUE
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  HALF_DAY
  SICK_LEAVE
  APPROVED_LEAVE
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ExamType {
  UNIT_TEST
  QUARTERLY
  HALF_YEARLY
  ANNUAL
  MODEL_EXAM
}

enum PaymentMode {
  CASH
  ONLINE
  CHEQUE
  CARD
  UPI
}

enum ActivityType {
  LOGIN
  LOGOUT
  CREATE
  UPDATE
  DELETE
  VIEW
  DOWNLOAD
  UPLOAD
  APPROVE
  REJECT
  PAYMENT
  ATTENDANCE_MARK
  EXPORT
  IMPORT
}

enum ActivityAction {
  USER_LOGIN
  USER_LOGOUT
  STUDENT_CREATE
  STUDENT_UPDATE
  STUDENT_DELETE
  STAFF_CREATE
  STAFF_UPDATE
  STAFF_DELETE
  FEE_PAYMENT
  ATTENDANCE_MARK
  EXAM_MARK
  TIMETABLE_CREATE
  DOCUMENT_UPLOAD
  DOCUMENT_DOWNLOAD
  EXPORT_DATA
  IMPORT_DATA
  APPROVE_REQUEST
  REJECT_REQUEST
  SETTINGS_CHANGE
  OTHER
}

enum LmsContentType {
  LESSON_NOTE
  VIDEO_LECTURE
  ASSIGNMENT
}

enum LmsVisibility {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum LmsSubmissionStatus {
  SUBMITTED
  GRADED
  LATE
}

enum FuelType {
  PETROL
  DIESEL
  CNG
  ELECTRIC
}

enum VehicleCondition {
  EXCELLENT
  GOOD
  FAIR
  POOR
  UNDER_MAINTENANCE
}

enum HostelType {
  BOYS
  GIRLS
  CO_ED
}

enum RoomType {
  SINGLE
  DOUBLE
  TRIPLE
  DORMITORY
}

enum BedStatus {
  OCCUPIED
  VACANT
  MAINTENANCE
}

enum ComplaintStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum PromotionStatus {
  PROMOTED
  DETAINED
  TRANSFERRED
}

enum TransferType {
  INTERNAL
  EXTERNAL
}

// User Model (Authentication)
model User {
  id                    String    @id @default(uuid())
  email                 String    @unique
  password              String
  role                  UserRole
  isActive              Boolean   @default(true)
  lastLogin             DateTime?
  passwordResetToken    String?   @unique
  passwordResetExpires  DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  // Relations
  student               Student?
  staff                 Staff?
  parent                Parent?
  userPermissions       UserPermission[]

  @@map("users")
}

// Academic Year
model AcademicYear {
  id            String    @id @default(uuid())
  year          String    @unique // e.g., "2024-2025"
  startDate     DateTime
  endDate       DateTime
  isCurrent     Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  classes       Class[]
  examSchedules ExamSchedule[]
  feeStructures FeeStructure[]

  @@map("academic_years")
}

// Class/Grade
model Class {
  id              String    @id @default(uuid())
  name            String    // e.g., "Grade 1", "10th Standard"
  section         String?   // e.g., "A", "B"
  academicYearId  String
  classTeacherId  String?
  capacity        Int       @default(40)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  academicYear    AcademicYear @relation(fields: [academicYearId], references: [id])
  classTeacher    Staff?       @relation("ClassTeacher", fields: [classTeacherId], references: [id])
  students        Student[]
  subjects        Subject[]
  timetables      Timetable[]
  attendances     Attendance[]
  examSchedules   ExamSchedule[]
  lmsContents     LmsContent[]
  promotionsFrom  StudentPromotion[] @relation("FromClassPromotion")
  promotionsTo    StudentPromotion[] @relation("ToClassPromotion")
  transfersFrom   StudentTransfer[]  @relation("FromClassTransfer")
  transfersTo     StudentTransfer[]  @relation("ToClassTransfer")

  @@unique([name, section, academicYearId])
  @@map("classes")
}

// Subject
model Subject {
  id            String    @id @default(uuid())
  name          String
  code          String    @unique
  classId       String
  teacherId     String?
  credits       Int       @default(1)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  class         Class     @relation(fields: [classId], references: [id])
  teacher       Staff?    @relation(fields: [teacherId], references: [id])
  timetables    Timetable[]
  examResults   ExamResult[]
  lmsContents   LmsContent[]

  @@map("subjects")
}

// Student Model
model Student {
  id                String    @id @default(uuid())
  userId            String    @unique
  admissionNo       String    @unique
  firstName         String
  lastName          String
  dateOfBirth       DateTime
  gender            Gender
  bloodGroup        BloodGroup?
  address           String
  phone             String
  parentId          String?
  classId           String
  admissionDate     DateTime  @default(now())
  profilePhoto      String?
  documents         Json?     // Store file paths
  medicalInfo       String?
  isActive          Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  user              User      @relation(fields: [userId], references: [id])
  parent            Parent?   @relation(fields: [parentId], references: [id])
  class             Class     @relation(fields: [classId], references: [id])
  attendances       Attendance[]
  feePayments       FeePayment[]
  examResults       ExamResult[]
  lmsSubmissions    LmsSubmission[]
  promotions        StudentPromotion[]
  transfers         StudentTransfer[]

  @@map("students")
}

model Permission {
  id              String           @id @default(uuid())
  key             String           @unique
  name            String
  module          String
  description     String?
  isSystem        Boolean          @default(false)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  rolePermissions RolePermission[]
  userPermissions UserPermission[]

  @@map("permissions")
}

model RolePermission {
  id            String     @id @default(uuid())
  role          UserRole
  permissionId  String
  allowed       Boolean    @default(true)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  permission    Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([role, permissionId])
  @@map("role_permissions")
}

model UserPermission {
  id            String     @id @default(uuid())
  userId        String
  permissionId  String
  allowed       Boolean    @default(true)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  permission    Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([userId, permissionId])
  @@map("user_permissions")
}

model RoleHierarchy {
  id          String    @id @default(uuid())
  parentRole  UserRole
  childRole   UserRole
  createdAt   DateTime  @default(now())

  @@unique([parentRole, childRole])
  @@map("role_hierarchy")
}

model StudentPromotion {
  id            String          @id @default(uuid())
  studentId     String
  fromClassId   String
  toClassId     String?
  status        PromotionStatus
  reason        String?
  remarks       String?
  performedBy   String
  performedAt   DateTime        @default(now())
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  student       Student         @relation(fields: [studentId], references: [id], onDelete: Cascade)
  fromClass     Class           @relation("FromClassPromotion", fields: [fromClassId], references: [id])
  toClass       Class?          @relation("ToClassPromotion", fields: [toClassId], references: [id])

  @@index([studentId])
  @@index([status])
  @@map("student_promotions")
}

model StudentTransfer {
  id               String       @id @default(uuid())
  studentId        String
  fromClassId      String
  toClassId        String?
  transferType     TransferType
  toSchoolName     String?
  toSchoolAddress  String?
  transferDate     DateTime     @default(now())
  reason           String?
  remarks          String?
  performedBy      String
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt

  student          Student      @relation(fields: [studentId], references: [id], onDelete: Cascade)
  fromClass        Class        @relation("FromClassTransfer", fields: [fromClassId], references: [id])
  toClass          Class?       @relation("ToClassTransfer", fields: [toClassId], references: [id])

  @@index([studentId])
  @@index([transferType])
  @@map("student_transfers")
}

// Parent Model
model Parent {
  id            String    @id @default(uuid())
  userId        String    @unique
  firstName     String
  lastName      String
  phone         String
  email         String?
  occupation    String?
  address       String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  user          User      @relation(fields: [userId], references: [id])
  students      Student[]

  @@map("parents")
}

// Staff Model
model Staff {
  id                String    @id @default(uuid())
  userId            String    @unique
  employeeId        String    @unique
  firstName         String
  lastName          String
  dateOfBirth       DateTime
  gender            Gender
  bloodGroup        BloodGroup?
  phone             String
  email             String?
  address           String
  designation       String
  department        String?
  joiningDate       DateTime
  salary            Float
  qualification     String?
  experience        Int?      // in years
  profilePhoto      String?
  documents         Json?
  isActive          Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  user              User      @relation(fields: [userId], references: [id])
  subjects          Subject[]
  timetables        Timetable[]
  classesAsTeacher  Class[]   @relation("ClassTeacher")
  leaves            Leave[]
  salaryPayments    SalaryPayment[]
  lmsContents        LmsContent[]
  vehiclesAsDriver  Vehicle[] @relation("VehicleDriver")
  vehiclesAsConductor Vehicle[] @relation("VehicleConductor")
  hostelsAsWarden   Hostel[]  @relation("HostelWarden")

  @@map("staff")
}

// Attendance
model Attendance {
  id            String            @id @default(uuid())
  studentId     String
  classId       String
  date          DateTime
  status        AttendanceStatus
  remarks       String?
  markedBy      String
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  // Relations
  student       Student           @relation(fields: [studentId], references: [id])
  class         Class             @relation(fields: [classId], references: [id])

  @@unique([studentId, date])
  @@map("attendances")
}

// Leave Management
model Leave {
  id            String      @id @default(uuid())
  staffId       String
  startDate     DateTime
  endDate       DateTime
  reason        String
  status        LeaveStatus @default(PENDING)
  approvedBy    String?
  remarks       String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // Relations
  staff         Staff       @relation(fields: [staffId], references: [id])

  @@map("leaves")
}

// Fee Structure
model FeeStructure {
  id              String    @id @default(uuid())
  academicYearId  String
  name            String    // e.g., "Tuition Fee", "Transport Fee"
  amount          Float
  dueDate         DateTime?
  description     String?
  isOptional      Boolean   @default(false)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  academicYear    AcademicYear @relation(fields: [academicYearId], references: [id])
  payments        FeePayment[]

  @@map("fee_structures")
}

// Fee Payment
model FeePayment {
  id                String      @id @default(uuid())
  studentId         String
  feeStructureId    String
  amount            Float
  paymentDate       DateTime    @default(now())
  paymentMode       PaymentMode
  transactionId     String?
  receiptNo         String      @unique
  status            FeeStatus   @default(PAID)
  remarks           String?
  collectedBy       String
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  // Relations
  student           Student     @relation(fields: [studentId], references: [id])
  feeStructure      FeeStructure @relation(fields: [feeStructureId], references: [id])

  @@map("fee_payments")
}

// Salary Payment
model SalaryPayment {
  id            String      @id @default(uuid())
  staffId       String
  month         String      // e.g., "2024-01"
  amount        Float
  paymentDate   DateTime
  paymentMode   PaymentMode
  transactionId String?
  remarks       String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // Relations
  staff         Staff       @relation(fields: [staffId], references: [id])

  @@unique([staffId, month])
  @@map("salary_payments")
}

// Timetable
model Timetable {
  id            String    @id @default(uuid())
  classId       String
  subjectId     String
  teacherId     String
  dayOfWeek     Int       // 0=Sunday, 1=Monday, etc.
  startTime     String    // e.g., "09:00"
  endTime       String    // e.g., "10:00"
  room          String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  class         Class     @relation(fields: [classId], references: [id])
  subject       Subject   @relation(fields: [subjectId], references: [id])
  teacher       Staff     @relation(fields: [teacherId], references: [id])

  @@unique([classId, dayOfWeek, startTime])
  @@map("timetables")
}

// Exam Schedule
model ExamSchedule {
  id              String    @id @default(uuid())
  name            String
  examType        ExamType
  classId         String
  academicYearId  String
  startDate       DateTime
  endDate         DateTime
  totalMarks      Int       @default(100)
  passingMarks    Int       @default(35)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  class           Class     @relation(fields: [classId], references: [id])
  academicYear    AcademicYear @relation(fields: [academicYearId], references: [id])
  results         ExamResult[]

  @@map("exam_schedules")
}

// Exam Result
model ExamResult {
  id              String    @id @default(uuid())
  studentId       String
  examScheduleId  String
  subjectId       String
  marksObtained   Float
  remarks         String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  student         Student   @relation(fields: [studentId], references: [id])
  examSchedule    ExamSchedule @relation(fields: [examScheduleId], references: [id])
  subject         Subject   @relation(fields: [subjectId], references: [id])

  @@unique([studentId, examScheduleId, subjectId])
  @@map("exam_results")
}

// Notification
model Notification {
  id            String    @id @default(uuid())
  title         String
  message       String
  type          String    // "SMS", "EMAIL", "PUSH"
  recipients    Json      // Array of user IDs or roles
  sentAt        DateTime  @default(now())
  sentBy        String
  status        String    @default("SENT")
  createdAt     DateTime  @default(now())

  @@map("notifications")
}

// Activity Log
model Activity {
  id            String    @id @default(uuid())
  userId        String
  action        ActivityAction
  actionType    ActivityType
  module        String    // e.g., "students", "fees", "attendance"
  description   String
  ipAddress     String?
  userAgent     String?
  resourceId    String?   // ID of the resource being acted upon (student/fee/etc.)
  resourceType  String?   // Type of resource (student/fee/attendance/etc.)
  changes       Json?     // Track what was changed (for updates)
  status        String    @default("SUCCESS") // SUCCESS, FAILED, PENDING
  createdAt     DateTime  @default(now())

  @@index([userId])
  @@index([createdAt])
  @@index([action])
  @@index([module])
  @@map("activities")
}

// ==================== LIBRARY MANAGEMENT SYSTEM MODELS ====================

model Book {
  id            String    @id @default(uuid())
  title         String
  author        String
  isbn          String    @unique
  publisher     String?
  edition       String?
  category      String
  description   String?
  totalCopies   Int       @default(1)
  costPrice     Float
  sellingPrice  Float?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  copies        BookCopy[]
  borrowRecords BorrowRecord[]
  holdRequests  BookHoldRequest[]

  @@index([title])
  @@index([author])
  @@index([isbn])
  @@index([category])
  @@map("books")
}

model BookCopy {
  id            String    @id @default(uuid())
  bookId        String
  barcode       String    @unique
  status        String    // AVAILABLE, ISSUED, DAMAGED, LOST, PENDING_REPAIR
  condition     String    // GOOD, FAIR, POOR
  issuedTo      String?   // Student or Staff ID
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  book          Book      @relation(fields: [bookId], references: [id], onDelete: Cascade)

  @@index([bookId])
  @@index([barcode])
  @@index([status])
  @@map("book_copies")
}

model BorrowRecord {
  id            String    @id @default(uuid())
  bookId        String
  memberId      String    // Student or Staff ID
  issueDate     DateTime  @default(now())
  dueDate       DateTime
  returnDate    DateTime?
  fineAmount    Float     @default(0)
  finePaid      Boolean   @default(false)
  finePaymentDate DateTime?
  renewalCount  Int       @default(0)
  maxRenewals   Int       @default(3)
  remarks       String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  book          Book      @relation(fields: [bookId], references: [id], onDelete: Cascade)

  @@index([bookId])
  @@index([memberId])
  @@index([dueDate])
  @@index([returnDate])
  @@map("borrow_records")
}

model BookHoldRequest {
  id            String    @id @default(uuid())
  bookId        String
  memberId      String    // Student or Staff ID
  requestDate   DateTime  @default(now())
  fulfillmentDate DateTime?
  status        String    @default("PENDING") // PENDING, FULFILLED, CANCELLED
  expiryDate    DateTime
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  book          Book      @relation(fields: [bookId], references: [id], onDelete: Cascade)

  @@index([bookId])
  @@index([memberId])
  @@index([status])
  @@map("book_hold_requests")
}

model LibrarySettings {
  id                    String    @id @default(uuid())
  issueLimit            Int       @default(5) // Books per member
  issuePeriodDays       Int       @default(14)
  finePerDay            Float     @default(5) // Currency per day
  maxFineLimit          Float     @default(100)
  holdRequestExpiryDays Int       @default(7)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@map("library_settings")
}

// ==================== LMS (LEARNING MANAGEMENT SYSTEM) MODELS ====================

model LmsContent {
  id            String         @id @default(uuid())
  title         String
  description   String?
  type          LmsContentType
  visibility    LmsVisibility  @default(DRAFT)
  classId       String
  subjectId     String
  teacherId     String
  dueDate       DateTime?
  totalMarks    Int?
  instructions  String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  // Relations
  class         Class          @relation(fields: [classId], references: [id])
  subject       Subject        @relation(fields: [subjectId], references: [id])
  teacher       Staff          @relation(fields: [teacherId], references: [id])
  attachments   LmsContentFile[]
  submissions   LmsSubmission[]

  @@index([classId])
  @@index([subjectId])
  @@index([teacherId])
  @@map("lms_contents")
}

model LmsContentFile {
  id            String    @id @default(uuid())
  contentId     String
  originalName  String
  filename      String
  path          String
  size          Int
  mimetype      String
  category      String?
  uploadedBy    String
  uploadedAt    DateTime  @default(now())

  // Relations
  content       LmsContent @relation(fields: [contentId], references: [id])

  @@index([contentId])
  @@map("lms_content_files")
}

model LmsSubmission {
  id            String              @id @default(uuid())
  contentId     String
  studentId     String
  status        LmsSubmissionStatus @default(SUBMITTED)
  submittedAt   DateTime            @default(now())
  grade         Float?
  feedback      String?
  gradedBy      String?
  gradedAt      DateTime?

  // Relations
  content       LmsContent          @relation(fields: [contentId], references: [id])
  student       Student             @relation(fields: [studentId], references: [id])
  attachments   LmsSubmissionFile[]

  @@unique([contentId, studentId])
  @@index([contentId])
  @@index([studentId])
  @@map("lms_submissions")
}

model LmsSubmissionFile {
  id            String    @id @default(uuid())
  submissionId  String
  originalName  String
  filename      String
  path          String
  size          Int
  mimetype      String
  category      String?
  uploadedBy    String
  uploadedAt    DateTime  @default(now())

  // Relations
  submission    LmsSubmission @relation(fields: [submissionId], references: [id])

  @@index([submissionId])
  @@map("lms_submission_files")
}

// Transport/Bus Management System Models

model Vehicle {
  id                String            @id @default(uuid())
  registrationNo    String            @unique
  model             String
  capacity          Int
  driverId          String?
  conductorId       String?
  serviceDate       DateTime
  maintenanceDate   DateTime?
  fuelType          FuelType
  averageMileage    Float
  currentMileage    Int               @default(0)
  gpsDeviceId       String?
  condition         VehicleCondition  @default(GOOD)
  insuranceExpiry   DateTime?
  notes             String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  // Relations
  driver            Staff?            @relation("VehicleDriver", fields: [driverId], references: [id])
  conductor         Staff?            @relation("VehicleConductor", fields: [conductorId], references: [id])
  route             Route?
  maintenanceRecords MaintenanceRecord[]
  boardingRecords   VehicleBoarding[]

  @@index([registrationNo])
  @@index([condition])
  @@map("vehicles")
}

model Route {
  id          String    @id @default(uuid())
  name        String
  vehicleId   String    @unique
  monthlyFee  Float
  totalStops  Int       @default(0)
  estimatedDuration Int? // in minutes
  notes       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  vehicle     Vehicle   @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  stops       BusStop[]
  students    StudentTransport[]

  @@index([vehicleId])
  @@map("routes")
}

model BusStop {
  id        String    @id @default(uuid())
  routeId   String
  stopName  String
  location  String
  latitude  Float?
  longitude Float?
  stopOrder Int
  arrivalTime String?
  estimatedWaitTime Int?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relations
  route     Route     @relation(fields: [routeId], references: [id], onDelete: Cascade)

  @@unique([routeId, stopOrder])
  @@index([routeId])
  @@map("bus_stops")
}

model StudentTransport {
  id            String    @id @default(uuid())
  studentId     String
  routeId       String
  pickupStop    String
  dropoffStop   String
  monthlyFee    Float
  feePaid       Boolean   @default(false)
  feePaymentDate DateTime?
  boardingStatus Boolean  @default(true)
  enrollmentDate DateTime  @default(now())
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  route         Route     @relation(fields: [routeId], references: [id], onDelete: Cascade)

  @@unique([studentId, routeId])
  @@index([routeId])
  @@index([studentId])
  @@map("student_transport")
}

model MaintenanceRecord {
  id          String    @id @default(uuid())
  vehicleId   String
  description String
  cost        Float
  date        DateTime
  nextServiceDate DateTime?
  parts       String?
  mechanic    String?
  createdAt   DateTime  @default(now())

  // Relations
  vehicle     Vehicle   @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@index([vehicleId])
  @@index([date])
  @@map("maintenance_records")
}

model VehicleBoarding {
  id            String    @id @default(uuid())
  vehicleId     String
  date          DateTime
  studentCount  Int       @default(0)
  capacity      Int
  remarks       String?
  createdAt     DateTime  @default(now())

  // Relations
  vehicle       Vehicle   @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@unique([vehicleId, date])
  @@index([vehicleId])
  @@index([date])
  @@map("vehicle_boarding")
}

model TransportSettings {
  id                        String    @id @default(uuid())
  defaultMonthlyFee         Float     @default(1000)
  lateFeePercentage         Float     @default(10)
  maxStudentsPerVehicle     Int       @default(50)
  maintenanceCheckInterval  Int       @default(30)
  fineForNoBoarding         Float     @default(100)
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime  @updatedAt

  @@map("transport_settings")
}

// ==================== Hostel Management Models ====================

model Hostel {
  id          String    @id @default(uuid())
  name        String
  type        HostelType
  capacity    Int
  wardenId    String?
  address     String?
  contactNo   String?
  facilities  String?   // Comma-separated facilities
  rules       String?   // Hostel rules and policies
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  warden      Staff?    @relation("HostelWarden", fields: [wardenId], references: [id])
  rooms       HostelRoom[]
  students    HostelStudent[]
  notices     HostelNotice[]

  @@index([type])
  @@map("hostels")
}

model HostelRoom {
  id          String    @id @default(uuid())
  hostelId    String
  roomNumber  String
  floor       Int?
  capacity    Int
  type        RoomType
  rentAmount  Float
  amenities   String?   // Comma-separated amenities
  status      String    @default("AVAILABLE") // AVAILABLE, FULL, MAINTENANCE
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  hostel      Hostel    @relation(fields: [hostelId], references: [id], onDelete: Cascade)
  beds        HostelBed[]

  @@unique([hostelId, roomNumber])
  @@index([hostelId])
  @@index([status])
  @@map("hostel_rooms")
}

model HostelBed {
  id        String    @id @default(uuid())
  roomId    String
  bedNo     Int
  status    BedStatus @default(VACANT)
  studentId String?   // Current occupant
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relations
  room      HostelRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@unique([roomId, bedNo])
  @@index([roomId])
  @@index([status])
  @@map("hostel_beds")
}

model HostelStudent {
  id              String    @id @default(uuid())
  studentId       String
  hostelId        String
  roomId          String
  bedId           String
  checkInDate     DateTime
  checkOutDate    DateTime?
  depositAmount   Float
  depositRefunded Boolean   @default(false)
  monthlyFee      Float
  feePaid         Boolean   @default(false)
  feePaymentDate  DateTime?
  emergencyContact String?
  specialRequirements String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  hostel          Hostel    @relation(fields: [hostelId], references: [id], onDelete: Cascade)

  @@unique([studentId, hostelId])
  @@index([hostelId])
  @@index([studentId])
  @@index([roomId])
  @@map("hostel_students")
}

model HostelVisitor {
  id          String    @id @default(uuid())
  studentId   String
  visitorName String
  relation    String?
  contactNo   String?
  purpose     String
  visitDate   DateTime
  inTime      DateTime?
  outTime     DateTime?
  approved    Boolean   @default(false)
  approvedBy  String?
  remarks     String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([studentId])
  @@index([visitDate])
  @@map("hostel_visitors")
}

model HostelComplaint {
  id          String    @id @default(uuid())
  studentId   String
  hostelId    String
  category    String    // MAINTENANCE, CLEANLINESS, SECURITY, NOISE, OTHER
  subject     String
  description String
  priority    String    @default("MEDIUM") // LOW, MEDIUM, HIGH, URGENT
  status      ComplaintStatus @default(OPEN)
  assignedTo  String?
  resolvedDate DateTime?
  resolution  String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([studentId])
  @@index([hostelId])
  @@index([status])
  @@map("hostel_complaints")
}

model HostelLeave {
  id          String    @id @default(uuid())
  studentId   String
  hostelId    String
  leaveFrom   DateTime
  leaveTo     DateTime
  reason      String
  destination String?
  contactNo   String
  status      LeaveStatus @default(PENDING)
  approvedBy  String?
  approvedDate DateTime?
  remarks     String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([studentId])
  @@index([hostelId])
  @@index([status])
  @@map("hostel_leaves")
}

model HostelNotice {
  id        String    @id @default(uuid())
  hostelId  String
  title     String
  content   String
  priority  String    @default("NORMAL") // NORMAL, IMPORTANT, URGENT
  isActive  Boolean   @default(true)
  createdBy String
  expiryDate DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relations
  hostel    Hostel    @relation(fields: [hostelId], references: [id], onDelete: Cascade)

  @@index([hostelId])
  @@index([isActive])
  @@map("hostel_notices")
}

model HostelAttendance {
  id          String    @id @default(uuid())
  studentId   String
  hostelId    String
  date        DateTime
  isPresent   Boolean   @default(true)
  remarks     String?
  recordedBy  String?
  recordedAt  DateTime  @default(now())
  createdAt   DateTime  @default(now())

  @@unique([studentId, hostelId, date])
  @@index([hostelId])
  @@index([studentId])
  @@index([date])
  @@map("hostel_attendance")
}

model HostelSettings {
  id                    String    @id @default(uuid())
  defaultMonthlyFee     Float     @default(3000)
  defaultDepositAmount  Float     @default(5000)
  visitorTimeFrom       String    @default("09:00") // HH:MM format
  visitorTimeTo         String    @default("18:00") // HH:MM format
  leaveApprovalRequired Boolean   @default(true)
  attendanceRequired    Boolean   @default(true)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@map("hostel_settings")
}
